---
title: 设计模式-单例模式的简单应用
date: 2018-03-30 11:42:43
tags:
- JavaScript
categories: [JavaScript设计模式,单例模式的简单应用]
---

### 实现QQ登陆框

```javascript
    <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <title>QQ登陆</title>
        </head>
        <body>
            <button id="loginBtn">登陆</button>
        </body>
        <script>
            // 1.进入页面创建dom
            var loginLayer = (function(){
                var div = document.createElement( 'div' )
                div.innerHTML = '我是登陆框'
                div.style.display = 'none'
                document.body.appendChild(div)
                return div
            })()

            document.getElementById('loginBtn').onclick = function(){
                loginLayer.style.display = 'block'
            }

            // 2.点击登入创建dom
            var creatLoginLayer = function(){
                var div = document.createElement( 'div' )
                div.innerHTML = '我是登陆框'
                div.style.display = 'none'
                document.body.appendChild(div)
                return div
            }

            document.getElementById('loginBtn').onclick = function(){
                var loginLayer = creatLoginLayer()
                loginLayer.style.display = 'block'
            }

            // 3.做一个单例的悬浮框
            var creatLoginLayer = (function(){
                var div
                return function(){
                    if(!div){
                        div = document.createElement( 'div' )
                        div.innerHTML = '我是登陆框'
                        div.style.display = 'none'
                        document.body.appendChild(div)
                    }
                    return div
                }
            })()

            document.getElementById('loginBtn').onclick = function(){
                var loginLayer = creatLoginLayer()
                loginLayer.style.display = 'block'
            }

        </script>
    </html>
```

### 实现单例模式抽离逻辑代码

```javascript
    <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <title>抽离逻辑代码</title>
        </head>
        <body>
            <button id="loginBtn">登陆</button>
        </body>
        <script>
            // 做一个通用的单例,将管理单例的逻辑从之前的代码中抽离出来
            var getSingle = function( fn ){
                var result 
                return function(){
                    return result || (result = fn.apply(this, arguments))
                }
            }

            var creatLoginLayer = function(){
                var div = document.createElement( 'div' )
                div.innerHTML = '我是登陆框'
                div.style.display = 'none'
                document.body.appendChild(div)
                return div
            }

            var createGetSingle = new getSingle(creatLoginLayer)

            document.getElementById('loginBtn').onclick = function(){
                var loginLayer = createGetSingle()
                loginLayer.style.display = 'block'
            }

            // iframe动态加载第三方页面
            var createGetSingleIframe = getSingle(function(){
                var iframe = document.createElement( 'iframe' )
                document.body.appendChild( iframe )
                return iframe
            })

            document.getElementById('loginBtn').onclick = function(){
                var loginLayer = createGetSingleIframe()
                loginLayer.src= 'http://baidu.com'
            }
            
            var bindEvent = getSingle(function(){
                document.getElementById('div1').onclick = function(){
                    alert('click')
                }
                return true
            })

            var render = function(){
                console.log('start')
                bindEvent()
            }

            render()
            render()
            render()

        </script>
    </html>
```

### 单例控制事件

```javascript
    <!DOCTYPE html>
        <html lang="en">
        <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <meta http-equiv="X-UA-Compatible" content="ie=edge">
            <title>单例控制事件</title>
        </head>
        <body>
            <button id="div1">点击</button>
        </body>
        <script>
            
            var bindEvent = getSingle(function(){
                document.getElementById('div1').onclick = function(){
                    alert('click')
                }
                return true
            })

            var render = function(){
                console.log('start')
                bindEvent()
            }

            render()
            render()
            render()

        </script>
    </html>
```