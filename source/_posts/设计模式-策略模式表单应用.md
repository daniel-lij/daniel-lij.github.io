---
title: 设计模式-策略模式表单应用
date: 2018-03-30 15:20:36
tags:
- JavaScript
categories: [JavaScript设计模式,策略模式表单应用]
---

### 策略模式表单应用

```javascript
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>简单表单验证</title>
    </head>
    <body>
        <form action="" id="registerForm" mothod="post">
            请输入用户名: <input type="text" name="userName"/>
            请输入密码: <input type="text" name="password"/>
            请输入手机号码: <input type="text" name="phoneNumber"/>
            <button>提交</button>
        </form>
        <script>
            var strategies = {
                isNonEmpty: function(value, errorMsg){
                    if(value === ''){
                        return errorMsg
                    }
                },
                minLength: function(value, length, errorMsg){
                    if(value.length < length){
                        return errorMsg
                    }
                },
                isMobile: function(value , errorMsg){
                    if(!/(1^[3][5][8][0-9]{9}$)/.test(value)){
                        return errorMsg
                    }
                }
            }

            var validataFunc = function(){
                var varlidator = new Varlidator()
                varlidator.add(registerForm.userName, 'isNonEmpty', '用户名不能为空')
                varlidator.add( registerForm.userName, 'minLength:10', '用户名不能小于10位')
                varlidator.add(registerForm.password, 'minLength:6', '密码长度不能少于6位')
                varlidator.add(registerForm.phoneNumber, 'isMobile', '手机号码格式不正确')
                var errorMsg = varlidator.start()
                return errorMsg
            }

            var registerForm = document.getElementById('registerForm')
            registerForm.onsubmit = function(){
                var errorMsg = validataFunc()
                if(errorMsg){
                    alert(errorMsg)
                    return false
                }
            }

            var Varlidator = function(){
                this.cache = [] 
            }

            Varlidator.prototype.add = function(dom, rule, errorMsg){
                var ary = rule.split(':')
                this.cache.push(function(){
                    var strategy = ary.shift()
                    ary.unshift(dom.value)
                    ary.push(errorMsg)
                    return strategies[ strategy ].apply( dom,ary )
                })
            }

            Varlidator.prototype.start = function(){
                for( var i=0, validataFunc; validataFunc = this.cache[ i++ ];){
                    var msg = validataFunc()
                    if( msg ){
                        return msg
                    }
                }
            }   
        </script>
    </body>
    </html>
```
