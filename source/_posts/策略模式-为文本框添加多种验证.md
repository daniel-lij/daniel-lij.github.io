---
title: 策略模式-为文本框添加多种验证
date: 2018-03-30 15:23:43
tags:
- JavaScript
categories: [JavaScript设计模式,策略模式为文本框添加多种验证]
---

### 策略模式为文本框添加多种验证

```javascript
    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>复杂表单验证</title>
    </head>
    <body>
        <form action="" id="registerForm" mothod="post">
            请输入用户名: <input type="text" name="userName"/>
            请输入密码: <input type="text" name="password"/>
            请输入手机号码: <input type="text" name="phoneNumber"/>
            <button>提交</button>
        </form>
        <script>
            var strategies = {
                isNonEmpty: function(value, errorMsg){
                    if(value === ''){
                        return errorMsg
                    }
                },
                minLength: function(value, length, errorMsg){
                    if(value.length < length){
                        return errorMsg
                    }
                },
                isMobile: function(value , errorMsg){
                    if(!/(1^[3][5][8][0-9]{9}$)/.test(value)){
                        return errorMsg
                    }
                }
            }

            var Varlidator = function(){
                this.cache = [] 
            }

            Varlidator.prototype.add = function(dom, rules){
                var self = this
                for( var i = 0, rule; rule = rules[i++];){
                    (function(rule){
                        var strategyAry = rule.strategy.split( ':' )
                        var errorMsg = rule.errorMsg
                        self.cache.push(function(){
                            var strategy = strategyAry.shift()
                            strategyAry.unshift( dom.value )
                            strategyAry.push( errorMsg )
                            return strategies[ strategy ].apply( dom, strategyAry )
                        })
                    })(rule)
                }
            }

            Varlidator.prototype.start = function(){
                for( var i=0, validataFunc; validataFunc = this.cache[ i++ ];){
                    var errorMsg = validataFunc()
                    if( errorMsg ){
                        alert(errorMsg)
                        return errorMsg
                    }
                }
            }

            /****************************** 客户端调用代码         ********************************/

            var registerForm = document.getElementById('registerForm')

            var validataFunc = function(){
                var varlidator = new Varlidator()
                varlidator.add(registerForm.userName, [{
                    strategy : 'isNonEmpty',
                    errorMsg : '用户名不能为空'
                },{
                    strategy : 'minLength:10',
                    errorMsg : '用户名长度不能少于10位'
                }])
                varlidator.add(registerForm.password,[{
                    strategy : 'minLength:6',
                    errorMsg : '密码长度不能少于6位'
                }])
                varlidator.add(registerForm.phoneNumber, [{
                    strategy : 'isMobile', 
                    errorMsg : '手机号码格式不正确'
                }])
                var errorMsg = varlidator.start()
                return errorMsg
            }

            registerForm.onsubmit = function(){
                var errorMsg = validataFunc()
                if(errorMsg){
                    alert(errorMsg)
                    return false
                }
            }
        </script>
    </body>
    </html>
```
